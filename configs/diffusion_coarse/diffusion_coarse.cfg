[trainer]
@trainer=diffusion

[logging]
save_dir="checkpoints/diffusion_coarse"
save_epochs=40
temp_save_epochs=1
mean_length=1024

[training]
batch_size=256
gradient_accumulation_steps=1
mixed_precision=fp16
epochs=150
epoch_steps=1024
seed=74
P_mean=0.0
P_std=1.5

[evaluation]
P_mean=0.0
P_std=1.5
validate_epochs=10
validation_steps=16384

[optimizer]
type=adam
kwargs={"betas": [0.9, 0.99]}

[scheduler]
@scheduler=edm_dpm
sigma_min=0.002
sigma_max=80
sigma_data=0.5

[ema]
sigma_rels=[0.05, 0.1]
update_every=1
checkpoint_every_num_steps=1024

[wandb]
project="generative_land"
tags=["coarse", "diffusion"]
mode=online
save_code=true

[model]
@model=unet
image_size=16
in_channels=11
out_channels=6
model_channels=128
model_channel_mults=[1]
layers_per_block=2
emb_channels=null
noise_emb_dims=null
attn_resolutions=[]
midblock_attention=false
concat_balance=0.5
conditional_inputs=[["float", 64, 0.2], ["float", 64, 0.2], ["float", 64, 0.2], ["float", 64, 0.2], ["float", 64, 0.2]]
fourier_scale="pos"
block_kwargs={}

[lr_sched]
@lr_sched=sqrt
lr=0.01
ref_nimg=1310720
warmup_nimg=327680

[train_dataset]
@dataset=coarse
h5_file=data/coarse.h5
etopo_file=data/global/ETOPO_2022_v1_30s_N90W180_bed.tif
mean_temp_file=data/global/wc2.1_30s_bio_1.tif
std_temp_file=data/global/wc2.1_30s_bio_4.tif
mean_precip_file=data/global/wc2.1_30s_bio_12.tif
std_precip_file=data/global/wc2.1_30s_bio_15.tif
crop_size=16
max_of_n=1

[val_dataset]
@dataset=coarse
h5_file=data/coarse.h5
etopo_file=data/global/ETOPO_2022_v1_30s_N90W180_bed.tif
mean_temp_file=data/global/wc2.1_30s_bio_1.tif
std_temp_file=data/global/wc2.1_30s_bio_4.tif
mean_precip_file=data/global/wc2.1_30s_bio_12.tif
std_precip_file=data/global/wc2.1_30s_bio_15.tif
crop_size=16
max_of_n=1

[dataloader_kwargs]
num_workers=15
persistent_workers=true
pin_memory=true
pin_memory_device=cuda
prefetch_factor=4
