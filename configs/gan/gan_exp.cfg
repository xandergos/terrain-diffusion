[trainer]
@trainer=gan_exp

[logging]
save_dir="checkpoints/gan_exp"
save_epochs=20
temp_save_epochs=1

[training]
batch_size=256
gradient_accumulation_steps=1
mixed_precision=fp16
epochs=200
epoch_steps=1024
seed=74
r_gamma=0.1
r_warmup_factor=10
lr_warmup_factor=4
r_interval=1
disc_lr_mult=1.0
kl_weight=1.0
blur_sigma=0
range_weight=0.0
burnin_steps=16384
eval_epochs=5

[g_optimizer]
type=adam
kwargs={"betas": [0.0, 0.99], "eps": 1e-8}

[d_optimizer]
type=adam
kwargs={"betas": [0.0, 0.99], "eps": 1e-8}

[ema]
sigma_rels=[0.05, 0.1]
update_every=1
checkpoint_every_num_steps=2048

[wandb]
project="generative_land"
tags=["gan"]
mode=online
save_code=true

[generator]
@model=dumb_generator
channels=6
model_channels=128
conv_depth=3
linear_depth=3
no_padding=true
fourier_channels=64

[discriminator]
@model=dumb_discriminator
channels=6
hidden_channels=128
cond_depth=3
channel_mults=[1]
layers_per_block=3
fourier_channels=64

[lr_sched]
@lr_sched=cosine
lr=0.00005
ref_nimg=1000000000
warmup_nimg=0

[train_dataset]
@dataset=gan
h5_file=data/gan.h5
etopo_file=data/global/ETOPO_2022_v1_30s_N90W180_bed.tif
mean_temp_file=data/global/wc2.1_30s_bio_1.tif
std_temp_file=data/global/wc2.1_30s_bio_4.tif
mean_precip_file=data/global/wc2.1_30s_bio_12.tif
std_precip_file=data/global/wc2.1_30s_bio_15.tif
crop_size=16

[val_dataset]
@dataset=gan
h5_file=data/gan.h5
etopo_file=data/global/ETOPO_2022_v1_30s_N90W180_bed.tif
mean_temp_file=data/global/wc2.1_30s_bio_1.tif
std_temp_file=data/global/wc2.1_30s_bio_4.tif
mean_precip_file=data/global/wc2.1_30s_bio_12.tif
std_precip_file=data/global/wc2.1_30s_bio_15.tif
crop_size=16

[dataloader_kwargs]
num_workers=15
persistent_workers=true
pin_memory=true
pin_memory_device=cuda