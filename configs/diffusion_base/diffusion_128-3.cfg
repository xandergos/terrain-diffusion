[trainer]
@trainer=diffusion

[logging]
save_dir="checkpoints/diffusion_base-128x3"
save_epochs=40
temp_save_epochs=3

[training]
batch_size=64
gradient_accumulation_steps=1
mixed_precision=fp16
epochs=1000
epoch_steps=1024
seed=74
P_mean=-0.6
P_std=1.3

[evaluation]
kid_batch_size=4
P_mean=-0.4
P_std=1.3
validate_epochs=20
validation_steps=16384
kid_n_images=1024
kid_scheduler_steps=12
kid_autoencoder_path="checkpoints/models/consistency_decoder-64x3"
mode=base

[optimizer]
type=adam
kwargs={"betas": [0.9, 0.99]}

[scheduler]
@scheduler=edm_dpm
sigma_min=0.002
sigma_max=80
sigma_data=0.5

[ema]
sigma_rels=[0.05, 0.1]
update_every=1
checkpoint_every_num_steps=5120

[wandb]
project="generative_land"
tags=["64x64", "diffusion", "simplified"]
mode=online
save_code=true

[model]
@model=unet
image_size=512
in_channels=5
out_channels=5
model_channels=128
model_channel_mults=[1, 2, 3, 4]
layers_per_block=3
emb_channels=null
noise_emb_dims=null
attn_resolutions=[8, 16]
midblock_attention=true
concat_balance=0.5
conditional_inputs=[["tensor", 58, 1.0]]
fourier_scale="pos"
#block_kwargs={"dropout": 0.0}

[lr_sched]
@lr_sched=sqrt
lr=0.01
ref_nimg=1310720
warmup_nimg=107495

[train_dataset]
@dataset=h5_latents
h5_file="data/dataset.h5"
crop_size=64
pct_land_ranges=[[0, 0.01], [0.01, 1]]
subset_resolutions=[90, 90]
subset_weights=[0.01, 0.99]
latents_mean=[0, 0, 0, 0]
latents_std=[1, 1, 1, 1]
sigma_data=0.5
beauty_dist=[false, true]
split="train"
residual_mean=0.0
residual_std=1.1678
cond_input_dropout=0.2
cond_input_max_noise=0.1
cond_input_mean=[9.90, 7.83, 12.22, 481.01, 626.46, 53.75, 0.667]
cond_input_std=[20.75, 20.69, 11.17, 475.80, 760.31, 43.35, 0.471]

[val_dataset]
@dataset=h5_latents
h5_file="data/dataset.h5"
crop_size=64
pct_land_ranges=[[0, 0.01], [0.01, 1]]
subset_resolutions=[90, 90]
subset_weights=[0.01, 0.99]
latents_mean=[0, 0, 0, 0]
latents_std=[1, 1, 1, 1]
sigma_data=0.5
beauty_dist=[false, true]
split="val"
residual_mean=0.0
residual_std=1.1678
cond_input_dropout=0.2
cond_input_max_noise=0.1
cond_input_mean=[9.90, 7.83, 12.22, 481.01, 626.46, 53.75, 0.667]
cond_input_std=[20.75, 20.69, 11.17, 475.80, 760.31, 43.35, 0.471]
with_ground_truth=true

[dataloader_kwargs]
num_workers=15
persistent_workers=true
pin_memory=true
pin_memory_device=cuda
prefetch_factor=2