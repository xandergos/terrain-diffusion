[trainer]
@trainer=consistency

[logging]
save_dir="checkpoints/consistency_base-192x3_30m"
save_epochs=20
temp_save_epochs=1

[training]
batch_size=12
gradient_accumulation_steps=4
mixed_precision=fp16
epochs=6500
epoch_steps=1024
seed=74
P_mean=-1.0
P_std=1.6
warmup_steps=10000
gradient_clip_val=5.0
sigma_data=0.5
const_c=0.1
use_logvar=true

[evaluation]
validate_epochs=5
kid_n_images=1024
kid_autoencoder_path="checkpoints/models/consistency_decoder-64x3"
mode=base
inter_t=1.1

[model]
main_path="checkpoints/diffusion_base-192x3_30m/latest_checkpoint/saved_model"
guide_path="checkpoints/diffusion_base-128x3_30m/latest_checkpoint/saved_model"
guidance_scale=2.15

[optimizer]
type=adam
kwargs={"betas": [0.9, 0.99]}

[lr_sched]
@lr_sched=constant
lr=0.00005

[ema]
sigma_rels=[0.05, 0.1]
update_every=1
checkpoint_every_num_steps=2048

[wandb]
project="generative_land"
tags=["64x64", "consistency"]
mode=online
save_code=true

[train_dataset]
@dataset=h5_latents
h5_file="data/dataset_30m.h5"
crop_size=64
pct_land_ranges=[[0, 0.01], [0.01, 1]]
subset_resolutions=[30, 30]
subset_weights=[0.01, 0.99]
latents_mean=[0, 0, 0, 0]
latents_std=[1, 1, 1, 1]
sigma_data=0.5
beauty_dist=[false, true]
split="train"
residual_mean=0.0
residual_std=0.7
cond_input_dropout=0.2
cond_input_max_noise=0.1
cond_input_mean=[14.99, 11.65, 15.87, 619.26, 833.12, 69.40, 0.66]
cond_input_std=[21.72, 21.78, 10.40, 452.29, 738.09, 34.59, 0.47]

[val_dataset]
@dataset=h5_latents
h5_file="data/dataset_30m.h5"
crop_size=64
pct_land_ranges=[[0, 0.01], [0.01, 1]]
subset_resolutions=[30, 30]
subset_weights=[0.01, 0.99]
latents_mean=[0, 0, 0, 0]
latents_std=[1, 1, 1, 1]
sigma_data=0.5
beauty_dist=[false, true]
split="val"
residual_mean=0.0
residual_std=0.7
cond_input_dropout=0.2
cond_input_max_noise=0.1
cond_input_mean=[14.99, 11.65, 15.87, 619.26, 833.12, 69.40, 0.66]
cond_input_std=[21.72, 21.78, 10.40, 452.29, 738.09, 34.59, 0.47]
val_dset=true

[dataloader_kwargs]
num_workers=15
persistent_workers=true
pin_memory=true
pin_memory_device=cuda
prefetch_factor=2

[scheduler]
@scheduler=edm_dpm
sigma_min=0.002
sigma_max=80
sigma_data=0.5

[sweep]
batch_size=8
min_ema_sigma=0.015
max_ema_sigma=0.25
min_intermediate_sigma=0.065
max_intermediate_sigma=0.065
min_ema_step=50000
max_ema_step=59392
baseline_first_trial=false
intermediate_steps=1024
prune_probability_threshold=0.05
kid_n_images=1024
kid_scheduler_steps=12
prior_weight=0.75
n_ei_candidates=64
n_startup_trials=7
tile_size=64

[sweep_dataset]
@dataset=h5_latents
h5_file="data/dataset_30m.h5"
crop_size=96
pct_land_ranges=[[0, 0.01], [0.01, 1]]
subset_resolutions=[30, 30]
subset_weights=[0.01, 0.99]
latents_mean=[0, 0, 0, 0]
latents_std=[1, 1, 1, 1]
sigma_data=0.5
beauty_dist=[false, true]
split="val"
residual_mean=0.0
residual_std=0.7
cond_input_dropout=0.2
cond_input_max_noise=0.1
cond_input_mean=[14.99, 11.65, 15.87, 619.26, 833.12, 69.40, 0.66]
cond_input_std=[21.72, 21.78, 10.40, 452.29, 738.09, 34.59, 0.47]
val_dset=true

[results_dataset]
@dataset=h5_latents
h5_file="data/dataset_30m.h5"
crop_size=64
pct_land_ranges=[[0, 0.01], [0.01, 1]]
subset_resolutions=[30, 30]
subset_weights=[0.01, 0.99]
latents_mean=[0, 0, 0, 0]
latents_std=[1, 1, 1, 1]
sigma_data=0.5
beauty_dist=[false, true]
split="val"
residual_mean=0.0
residual_std=0.7
cond_input_dropout=0.2
cond_input_max_noise=0.1
cond_input_mean=[14.99, 11.65, 15.87, 619.26, 833.12, 69.40, 0.66]
cond_input_std=[21.72, 21.78, 10.40, 452.29, 738.09, 34.59, 0.47]
val_dset=true